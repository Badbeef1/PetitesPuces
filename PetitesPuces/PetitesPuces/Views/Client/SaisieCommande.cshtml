@using PetitesPuces.Models
@model List<PPArticlesEnPanier>
@{
    Layout = null;
}
<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="~/Content/css/styleGeneral.css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
<script>
    $(document).ready(function () {
        $("#btnContinueMagasiner").click(function () {
            window.location.href = "/Client/Catalogue"
        });

        // Bouton poursuivre du première onglet
        $("#btnPasserCommande").click(function () {
            $("#divCommande").attr("hidden", true);
            $("#divTransaction").attr("hidden", false);
            $("#divFacturation").attr("hidden", true);
            $("#collapse_zoneCommande").collapse();
            $("#collapse_zoneInfos").collapse("show");
            $("#btnInformationLivraison").removeClass("disabled");
        });

        // Bouton première onglet
        $("#btnCommandeTab").click(function () {
            $("#divCommande").attr("hidden", false);
            $("#divTransaction").attr("hidden", true);
            $("#divFacturation").attr("hidden", true);
        });
        // Bouton deuxième onglet
        $("#btnTransactionTab").click(function () {
            $("#divCommande").attr("hidden", true);
            $("#divTransaction").attr("hidden", false);
            $("#divFacturation").attr("hidden", true);
        });
        // Bouton troisième onglet
        $("#btnFacturationTab").click(function () {
            setTimeout(function () {
                $("#divCommande").attr("hidden", false);
                $("#divTransaction").attr("hidden", true);
                $("#divFacturation").attr("hidden", true);
            }, 2000)
        });


    });
    function quantitechange(e) {
        if (e.which == 13) {
            e.preventDefault();
        }
    }

    function supprimerProduit(id) {

        $.ajax({
            url: "/Client/SupprimerProduitSaisieCommande",
            data: { "id": id },
            success: success,
            error: error,
        });
    }
    function updateCart(noPanier) {
        var quantite = $('#' + noPanier).val();
        console.log('J\'update le cart');
        $.ajax({
            url: "/Client/UpdatePanierSaisieCommande",
            data: { "noPanier": noPanier, "quantite": quantite },
            success: success,
            error: error,
        });
    }


    function success(model) {
        $("#body").html(model)
        //console.log(model);
    }

    function error(error) {
        console.log('erreur : ' + error);
        location.href = '/Client/AccueilClient';
    }
</script>
<style>
    .quantity {
        float: left;
        background-color: #eee;
        position: relative;
        width: 80px;
        overflow: hidden
    }

        .quantity input {
            margin: 0;
            text-align: center;
            width: 15px;
            height: 15px;
            padding: 0;
            float: right;
            color: #000;
            font-size: 20px;
            border: 0;
            outline: 0;
            background-color: #F6F6F6
        }

            .quantity input.qty {
                position: relative;
                border: 0;
                width: 100%;
                height: 40px;
                padding: 10px 25px 10px 10px;
                text-align: center;
                font-weight: 400;
                font-size: 15px;
                border-radius: 0;
                background-clip: padding-box
            }

        .quantity .minus, .quantity .plus {
            line-height: 0;
            background-clip: padding-box;
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
            -webkit-background-size: 6px 30px;
            -moz-background-size: 6px 30px;
            color: #bbb;
            font-size: 20px;
            position: absolute;
            height: 50%;
            border: 0;
            right: 0;
            padding: 0;
            width: 25px;
            z-index: 3
        }

            .quantity .minus:hover, .quantity .plus:hover {
                background-color: #dad8da
            }

        .quantity .minus {
            bottom: 0
        }

    .shopping-cart {
        margin-top: 20px;
    }
    button:disabled {
        background-color: #dddddd;
    }
    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

        /* Style the buttons that are used to open the tab content */
        .tab button {
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

            /* Change background color of buttons on hover */
            .tab button:hover {
                background-color: #ddd;
            }

            /* Create an active/current tablink class */
            .tab button.active {
                background-color: #ccc;
            }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }
</style>
<html>
<head>
    <title>Saisie d'une commande</title>
</head>
<body id="body">
    <!-- Barre de navigation -->
    <div id="navigation">
        @RenderPage("~/Views/Client/index.cshtml")
    </div>

    <!-- Commande détaillée -->
    <div class="container sEspaceBarNavigation" id="bigDiv">
        <div class="card shopping-cart" id="accordion">
            <div class="card-header" id="heading_commande">

                <div class="float-left">
                    <h5 class="mb-0">
                        <button id="btnCommande" class="btn btn-link text-s" data-toggle="collapse" data-target="#collapse_zoneCommande" aria-expanded="true" aria-controls="#collapse_zoneCommande">
                            Commande
                        </button>
                    </h5>
                </div>
                <div class="float-right">
                    <button id="btnContinueMagasiner" type="button" class="btn btn-primary btn-sm btn-block">
                        <span class="glyphicon glyphicon-share-alt"></span> Continuer à magasiner
                    </button>
                </div>
            </div>

            <div id="collapse_zoneCommande" class="collapse show" aria-labelledby="btnCommande" data-parent="#accordion">

                <div class="card-body">
                    <!-- Loop d'article -->
                    @{
                        double dblPrixTotal = 0.0;
                        double dblPrixProduitCourant = 0.0;
                        int compteur = 0;
                        double poidsKg = 0;
                    }
                    @for (int x = 0; x < Model.Count; x++)
                    {
                        poidsKg += (int)Model[x].NbItems * (double)Model[x].PPProduits.Poids;
                        dblPrixProduitCourant = ((int)Model[x].NbItems * (double)Model[x].PPProduits.PrixDemande);
                        double dblPrixStdUnit = 1 * (double)Model[x].PPProduits.PrixDemande;
                        dblPrixTotal += ((int)Model[x].NbItems * (double)Model[x].PPProduits.PrixDemande);
                        @Html.HiddenFor(lst => lst[x].DateCreation)
                        @Html.HiddenFor(lst => lst[x].NoClient)
                        @Html.HiddenFor(lst => lst[x].NoPanier)
                        @Html.HiddenFor(lst => lst[x].NoProduit)
                        @Html.HiddenFor(lst => lst[x].NoVendeur)
                        @Html.HiddenFor(lst => lst[x].PPClients.NoClient)
                        @Html.HiddenFor(lst => lst[x].PPVendeurs.NoVendeur)
                        @Html.HiddenFor(lst => lst[x].NbItems)
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-2 my-auto justify-content-center">
                                <img class="img-responsive" src="~/Content/images/@Model[x].PPProduits.Photo" alt="prewiew" width="120" height="80">
                            </div>
                            <div class="col-12 text-sm-center col-sm-12 text-md-left col-md-5">
                                <h4 class="product-name"><strong>@Model[x].PPProduits.Nom</strong></h4>
                                <small>Poids unitaire : @Model[x].PPProduits.Poids Kg</small>
                                <h4>
                                    <small>@Model[x].PPProduits.Description</small>
                                </h4>
                            </div>
                            <div class="col-12 col-sm-12 text-sm-center col-md-5 text-md-right row align-items-center" style="padding-right:0px">
                                <div class="col-2 col-sm-2 col-md-4 text-md-left" style="padding-top: 10px;padding-right:0px">
                                    <h6><strong>@dblPrixStdUnit.ToString("0.00")$ <span class="text-muted">x</span></strong></h6>

                                </div>
                                <div class="col-2 col-sm-2 col-md-2" style="padding-left:0px;padding-right:0px">
                                    <div class="quantity">
                                        <input id="@Model[x].NoPanier" type="number" min="1" max="99" step="1" class="qty" value="@Model[x].NbItems" onchange="updateCart(@Model[x].NoPanier)" onkeyup="">
                                    </div>
                                </div>

                                <div class="col-3 col-sm-3 col-md-3 text-right" style="padding-top: 10px;padding-right:0px">
                                    <h6>
                                        &nbsp;<strong>@dblPrixProduitCourant.ToString("0.00")$</strong>
                                    </h6>
                                </div>
                                <div class="col-1 col-sm-1 col-md-1">
                                    <button type="button" class="btn btn-outline-danger btn-xs" id="btnSupprimmer_@Model[x].NoPanier" onclick="supprimerProduit(@Model[x].NoPanier)">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                        @*Html.ActionLink("Supprimer", "SupprimerProduit", "Client", new { id = Model[x].NoPanier}, new { })*@
                                    </button>
                                </div>
                            </div>
                        </div>
                        <hr />
                        compteur++;
                    }
                    <div class="card-footer">
                        <div class="row" style="padding:0px;margin:0px">
                            <div class="col-4 text-left">
                                Poids de la livraison : 
                                @if (Model[0].PPVendeurs.PoidsMaxLivraison > poidsKg)
                                {
                                    <span style="color:green" class="border border-success"> @poidsKg Kg/ @Model[0].PPVendeurs.PoidsMaxLivraison Kg</span>
                                }
                                else
                                {
                                    <span class="border border-danger" style="color:red"> @poidsKg Kg / @Model[0].PPVendeurs.PoidsMaxLivraison Kg</span>
                                }
                                    </div>
                                    <div class="col-6 text-right" style="padding-right:0px">
                                        <h5>Sous-total</h5>
                                        <h5>TPS (5%)</h5>
                                        @{
                                            if (Model[0].PPVendeurs.Province.ToString().Equals("QC"))
                                            {
                                                <h5> TVQ(9.975 %) </h5>
                                            }
                                        }

                                        <h5>Total</h5>
                                    </div>
                                    <div class="col-2 text-right">
                                        <h5><strong>@dblPrixTotal.ToString("0.00") $</strong></h5>
                                        @{
                                            double totalTps = (dblPrixTotal * 0.05);
                                        }

                                        @{
                                            <h5>
                                                <strong>
                                                    @totalTps.ToString("0.00") $
                                                </strong>
                                            </h5>
                                        }
                                        @{
                                            double totalTvq = 0;
                                            if (Model[0].PPVendeurs.Province.ToString().Equals("QC"))
                                            {
                                                totalTvq = (dblPrixTotal * 0.09975);
                                                <h5>
                                                    <strong>
                                                        @totalTvq.ToString("0.00") $
                                                    </strong>
                                                </h5>
                                            }
                                        }

                                        <h5>
                                            <strong>
                                                @{
                                                    double totalAvecTaxes = dblPrixTotal + totalTps + totalTvq;
                                                }@totalAvecTaxes.ToString("0.00") $
                                            </strong>
                                        </h5>
                                    </div>
                                </div>
                        <div class="row" style="padding:15px">

                            <div class="col-sm-6">
                            </div>
                            <div class="col-sm-6">
                                <div class="d-flex justify-content-end">
                                    @if (Model[0].PPVendeurs.PoidsMaxLivraison > poidsKg)
                                    {

                                        <button id="btnPasserCommande" class="btn btn-success" type="submit">
                                            Passer une commande
                                        </button>
                                    }
                                    else
                                    {

                                        <button id="btnPasserCommande" class="btn btn-success" disabled type="submit" tool>
                                            Passer une commande
                                        </button>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Second Onglet -->
        <div class="card shopping-cart" id="infoPerso" style="margin-top:0px;">
            <div class="card-header" id="heading_infoPerso">

                <div class="float-left">
                    <h5 class="mb-0">
                        <button id="btnInformationLivraison" class="btn btn-link text-s disabled" data-toggle="collapse" data-target="#collapse_zoneInfos" aria-expanded="true" aria-controls="#collapse_zoneInfos">
                            Informations de livraison
                        </button>
                    </h5>
                </div>
            </div>

            <div id="collapse_zoneInfos" class="collapse" aria-labelledby="btnInformationLivraison" data-parent="#infoPerso">

                <div class="card-body">
                                <h3><u>Information personnelle</u></h3>
                                <div class="row">
                                    <label class="col-2" for="email">Courriel électronique</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-2" for="lastName">Nom</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" style="text-align:left" for="firstName">Prénom</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" for="tel1">Téléphone primaire</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" for="tel2">Téléphone secondaire</label>
                                </div>
                                <div class="row">

                                    <input class="col-2" id="email" style="margin-left:15px" type="text" />
                                    <div class="col-offset-1"></div>
                                    <input class="col-2" id="lastName" type="text" />
                                    <div class="col-offset-1"></div>
                                    <input class="col-1" id="firstName" type="text" />
                                    <div class="col-offset-1"></div>
                                    <input class="col-1" id="tel1" type="text" />
                                    <div class="col-offset-1"></div>
                                    <input class="col-1" id="tel2" type="text" />
                                </div>
                                <div class="row">
                                    <label class="col-2" for="rue">Rue</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-2" for="ville">Ville</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" for="province">Province</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" for="pays">Pays</label>
                                    <div class="col-offset-1"></div>
                                    <label class="col-1" for="codePostal">Code Postal</label>
                                </div>
                                <div class="row">

                                    <input class="col-2" style="margin-left:15px" id="rue" type="text" />
                                    <div class="col-offset-1"></div>
                                    <input class="col-2" id="ville" type="text" />
                                    <div class="col-offset-1"></div>
                                    <select class="col-1">
                                        <option value="0">Québec</option>
                                        <option value="1">Ontario</option>
                                        <option value="2">Nouveau-Brunswick</option>
                                    </select>
                                    <div class="col-offset-1"></div>
                                    <input class="col-1" id="pays" type="text" value="Canada" disabled />
                                    <div class="col-offset-1"></div>
                                    <input class="col-1" id="codePostal" type="text" />
                                </div>
                            </div>
                        </div>
                        <div class="container">
                            <div class="panel panel-info">
                                <div class="panel-heading" style="padding-left:20px;padding-right:20px">
                                    <h3><u>Information de paiement</u></h3>
                                    <p>Informations nécessaires?</p>
                                </div>
                            </div>
                        </div>
                        <div class="row align-items-center">
                            <div class="col-4"></div>
                            <input type="button" id="btnConfirmer" class="btn btn-success btn-block col-4" value="Confirmer" style="width:30%" />
                            <div class="col-4"></div>
                        </div>
                    </div>
                    <!-- Troisième et Dernier Onglet -->
                    <div id="divFacturation" style="padding-left:10px;padding-right:10px">
                    </div>
                    <div>
                    </div>
                </div>
</body>
</html>
